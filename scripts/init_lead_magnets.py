"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–°–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ "–û–°–ù–û–í–ê P U T –ò".
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—å
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from loguru import logger
from app.core.database import get_db_session
from app.services.lead_magnet_service import LeadMagnetService
from app.models.lead_magnet import LeadMagnetType


async def create_default_lead_magnets():
    """–°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é."""
    
    lead_magnets_data = [
        {
            "name": "7-–¥–Ω–µ–≤–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ —Å–∏–ª—ã",
            "description": "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ —Å–∏–ª—ã –≤–æ–ª–∏",
            "type": LeadMagnetType.GOOGLE_SHEET,
            "file_url": "https://docs.google.com/spreadsheets/d/your-sheet-id/edit?usp=sharing",
            "message_text": (
                "üéØ <b>–í–∞—à —Ç—Ä–µ–∫–µ—Ä –≥–æ—Ç–æ–≤!</b>\n\n"
                "üìã <b>–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:</b>\n"
                "‚Ä¢ 7 –¥–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç—Ä–µ–∫–∏–Ω–≥–∞\n"
                "‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: —É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∏—Ç—É–∞–ª—ã, —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –æ–±—É—á–µ–Ω–∏–µ\n"
                "‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–æ–∫ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏\n"
                "‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n\n"
                "üí° <b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</b>\n"
                "1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∏–∂–µ\n"
                "2. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–ø–∏—é –¥–ª—è —Å–µ–±—è\n"
                "3. –ó–∞–ø–æ–ª–Ω—è–π—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å\n"
                "4. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å\n\n"
                "üî• <b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b> –ó–∞ 7 –¥–Ω–µ–π –≤—ã –∑–∞–ª–æ–∂–∏—Ç–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫!"
            ),
            "is_active": True,
            "sort_order": 1
        },
        {
            "name": "7-–¥–Ω–µ–≤–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ —Å–∏–ª—ã (PDF)",
            "description": "PDF –≤–µ—Ä—Å–∏—è —Ç—Ä–µ–∫–µ—Ä–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏",
            "type": LeadMagnetType.PDF,
            "file_url": "https://your-domain.com/files/7-day-tracker.pdf",
            "message_text": (
                "üìÑ <b>PDF –≤–µ—Ä—Å–∏—è —Ç—Ä–µ–∫–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞!</b>\n\n"
                "üìã <b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ PDF –≤–µ—Ä—Å–∏–∏:</b>\n"
                "‚Ä¢ –ú–æ–∂–Ω–æ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –æ—Ç —Ä—É–∫–∏\n"
                "‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞\n"
                "‚Ä¢ –£–¥–æ–±–Ω–æ –±—Ä–∞—Ç—å —Å —Å–æ–±–æ–π\n"
                "‚Ä¢ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è\n\n"
                "üí° <b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</b>\n"
                "1. –°–∫–∞—á–∞–π—Ç–µ PDF –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∏–∂–µ\n"
                "2. –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π\n"
                "3. –ó–∞–ø–æ–ª–Ω—è–π—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å\n"
                "4. –•—Ä–∞–Ω–∏—Ç–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n\n"
                "üî• <b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b> –§–∏–∑–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–µ—Ä –ø–æ–º–æ–∂–µ—Ç –ª—É—á—à–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å!"
            ),
            "is_active": True,
            "sort_order": 2
        }
    ]
    
    try:
        async with get_db_session() as session:
            lead_magnet_service = LeadMagnetService(session)
            
            for magnet_data in lead_magnets_data:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ª–∏–¥-–º–∞–≥–Ω–∏—Ç
                existing_magnets = await lead_magnet_service.get_all_lead_magnets()
                existing_names = [m.name for m in existing_magnets]
                
                if magnet_data["name"] not in existing_names:
                    # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ª–∏–¥-–º–∞–≥–Ω–∏—Ç
                    lead_magnet = await lead_magnet_service.create_lead_magnet(magnet_data)
                    logger.info(f"‚úÖ –°–æ–∑–¥–∞–Ω –ª–∏–¥-–º–∞–≥–Ω–∏—Ç: {lead_magnet.name}")
                else:
                    logger.info(f"‚ö†Ô∏è –õ–∏–¥-–º–∞–≥–Ω–∏—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {magnet_data['name']}")
            
            logger.info("üéâ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
            
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤: {e}")
        raise


async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    try:
        logger.info("üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤...")
        await create_default_lead_magnets()
        logger.info("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
        
    except Exception as e:
        logger.error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        sys.exit(1)


if __name__ == "__main__":
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    logger.remove()
    logger.add(
        sys.stdout,
        level="INFO",
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>"
    )
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    asyncio.run(main())
