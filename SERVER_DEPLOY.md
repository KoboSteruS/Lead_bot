# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üì¶ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ —ç—Ç–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

1. ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤** - –º–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å PDF, –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ñ–æ—Ç–æ
2. ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤ –ø–æ Telegram ID –ø—Ä—è–º–æ –∏–∑ –±–æ—Ç–∞
3. ‚úÖ **–ü–æ–ª–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–æ–≥—Ä–µ–≤–∞** - –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å–æ–æ–±—â–µ–Ω–∏—è
4. ‚úÖ **–ü–æ–ª–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤** - –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω–∞, —Å—Å—ã–ª–∫–∞, –æ—Ñ—Ñ–µ—Ä
5. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏** —Å callback handlers –∏ UUID

## üîß –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (3 –∫–æ–º–∞–Ω–¥—ã)

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥
cd ~/Lead_bot
git pull origin main

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–í–°–ï –í –û–î–ù–û–ú –°–ö–†–ò–ü–¢–ï!)
bash migrate_all.sh

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
systemctl restart leadbot
```

**–ì–æ—Ç–æ–≤–æ!** ‚úÖ

---

## üìù –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@vjaceslavs.scukins.fvds.ru

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd ~/Lead_bot

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã)
systemctl stop leadbot
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

```bash
# –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
git status
git log --oneline -5
```

### –®–∞–≥ 3: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)** ‚≠ê

```bash
bash migrate_all.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –î–æ–±–∞–≤–∏—Ç `telegram_file_id` –≤ `lead_magnets`
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `admins`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–°–ø–æ—Å–æ–± 2: –ü–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏**

```bash
# –ú–∏–≥—Ä–∞—Ü–∏—è 1: telegram_file_id
bash migrate.sh

# –ú–∏–≥—Ä–∞—Ü–∏—è 2: —Ç–∞–±–ª–∏—Ü–∞ admins
python3 scripts/create_admins_table.py
```

**–°–ø–æ—Å–æ–± 3: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL**

```bash
sqlite3 leadbot.db <<EOF
-- –î–æ–±–∞–≤–ª—è–µ–º telegram_file_id
ALTER TABLE lead_magnets ADD COLUMN telegram_file_id TEXT;

-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É admins
CREATE TABLE IF NOT EXISTS admins (
    id VARCHAR(36) PRIMARY KEY,
    telegram_id BIGINT NOT NULL UNIQUE,
    username VARCHAR(255),
    full_name VARCHAR(255),
    is_active BOOLEAN NOT NULL DEFAULT 1,
    access_level BIGINT NOT NULL DEFAULT 1,
    added_by_id BIGINT,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME
);

CREATE INDEX IF NOT EXISTS ix_admins_telegram_id ON admins(telegram_id);
EOF
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î
sqlite3 leadbot.db "SELECT name FROM sqlite_master WHERE type='table' ORDER BY name;"

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É admins
```

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: —á–µ—Ä–µ–∑ systemctl
systemctl start leadbot
systemctl status leadbot

# –í–∞—Ä–∏–∞–Ω—Ç 2: —á–µ—Ä–µ–∑ supervisorctl
supervisorctl restart leadbot
supervisorctl status leadbot

# –í–∞—Ä–∏–∞–Ω—Ç 3: –≤—Ä—É—á–Ω—É—é
pkill -f "python.*main.py"
nohup python3 main.py > /dev/null 2>&1 &
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: —á–µ—Ä–µ–∑ journalctl
journalctl -u leadbot -f

# –í–∞—Ä–∏–∞–Ω—Ç 2: —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤
tail -f logs/leadbot*.log

# –í–∞—Ä–∏–∞–Ω—Ç 3: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
tail -50 logs/leadbot*.log
```

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**
```
INFO | Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω
INFO | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
INFO | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∑–∞–ø—É—â–µ–Ω
```

**–ß–µ–≥–æ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚ùå no such column: lead_magnets.telegram_file_id
‚ùå no such table: admins
‚ùå cannot access local variable 'LeadMagnetType'
```

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤

**–í –±–æ—Ç–µ:**
```
/admin ‚Üí üéÅ –õ–∏–¥-–º–∞–≥–Ω–∏—Ç—ã ‚Üí ‚ûï –î–æ–±–∞–≤–∏—Ç—å
–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: "–ú–æ–π PDF –≥–∞–π–¥"
[–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª PDF]
‚úÖ –õ–∏–¥-–º–∞–≥–Ω–∏—Ç —Å–æ–∑–¥–∞–Ω!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Telegram (file_id)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
- –ù–µ –Ω—É–∂–µ–Ω –≤–Ω–µ—à–Ω–∏–π —Ö–æ—Å—Ç–∏–Ω–≥

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ:**
```
/admin ‚Üí üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã ‚Üí ‚ûï –î–æ–±–∞–≤–∏—Ç—å
–í–≤–µ–¥–∏—Ç–µ Telegram ID: 987654321
‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª–µ–Ω!
```

**–£–¥–∞–ª–µ–Ω–∏–µ:**
```
/admin ‚Üí üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã ‚Üí üóë –£–¥–∞–ª–∏—Ç—å
–í–≤–µ–¥–∏—Ç–µ Telegram ID: 987654321
‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É–¥–∞–ª–µ–Ω!
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä:**
```
/admin ‚Üí üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã

–í—ã —É–≤–∏–¥–∏—Ç–µ:
üìå –ò–∑ .env —Ñ–∞–π–ª–∞ (–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å):
   ‚Ä¢ 1670311707

üíæ –ò–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
   ‚úÖ –ò–º—è –ê–¥–º–∏–Ω–∞
      ID: 987654321
      Username: @admin_username
```

### 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

```
/admin ‚Üí üî• –ü—Ä–æ–≥—Ä–µ–≤ ‚Üí [–í—ã–±—Ä–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π] ‚Üí ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

–î–æ—Å—Ç—É–ø–Ω–æ:
‚Ä¢ üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
‚Ä¢ üìÑ –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
‚Ä¢ ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
‚Ä¢ üìã –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
```

### 4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

```
/admin ‚Üí üí∞ –¢—Ä–∏–ø–≤–∞–π–µ—Ä—ã ‚Üí ‚úèÔ∏è [–ü—Ä–æ–¥—É–∫—Ç]

–î–æ—Å—Ç—É–ø–Ω–æ:
‚Ä¢ üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
‚Ä¢ üìÑ –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
‚Ä¢ üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É
‚Ä¢ üîó –ò–∑–º–µ–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É
‚Ä¢ üìã –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—Ñ—Ñ–µ—Ä–∞
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
journalctl -u leadbot -n 50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep python

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã
netstat -tulpn | grep python
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

```bash
# –°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
journalctl -u leadbot | grep ERROR | tail -20

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î
sqlite3 leadbot.db ".tables"
sqlite3 leadbot.db "PRAGMA table_info(admins);"
sqlite3 leadbot.db "PRAGMA table_info(lead_magnets);"
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –∞–¥–º–∏–Ω—ã
sqlite3 leadbot.db "SELECT * FROM admins;"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env
cat .env | grep ADMIN_IDS
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –§–∞–π–ª—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ telegram_file_id
sqlite3 leadbot.db "SELECT name, telegram_file_id FROM lead_magnets;"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –≤—ã–¥–∞—á–µ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–∞
journalctl -u leadbot -f
# –ó–∞—Ç–µ–º –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç –≤ –±–æ—Ç–µ
```

---

## üìä –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –¢–∞–±–ª–∏—Ü—ã –≤ –ë–î:

```
admins                  ‚Üê –ù–û–í–ê–Ø
lead_magnets           ‚Üê –û–ë–ù–û–í–õ–ï–ù–ê
mailings
mailing_recipients
product_offers
products
user_followups
user_lead_magnets
user_product_offers
user_warmup_messages
user_warmups
users
warmup_messages
warmup_scenarios
```

### –ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:

- `lead_magnets.telegram_file_id` ‚Üê –ù–û–í–ê–Ø

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:

- üë®‚Äçüíº –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã ‚Üê –ù–û–í–´–ô –†–ê–ó–î–ï–õ
- ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–ø–æ–ª–Ω–æ–µ)
- ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–ø–æ–ª–Ω–æ–µ)
- üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤

---

## üìù –ö–æ–º–º–∏—Ç—ã —ç—Ç–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```
‚úÖ fix: Fix callback handler order and Message is not modified errors
‚úÖ feat: Add file upload support for lead magnets with Telegram file_id storage
‚úÖ fix: Fix LeadMagnetType import and add migration script for telegram_file_id
‚úÖ docs: Add migration guide for telegram_file_id feature
‚úÖ feat: Add multiple migration methods for telegram_file_id (bash, python, sql)
‚úÖ feat: Add admin management system with DB storage and TG ID control
‚úÖ docs: Add comprehensive admin management migration guide
```

---

## ‚ú® –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
cd ~/Lead_bot && \
git pull origin main && \
bash migrate_all.sh && \
systemctl restart leadbot && \
echo "‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" && \
journalctl -u leadbot -f
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ - –≤—Å—ë —Å–¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!** üöÄ

